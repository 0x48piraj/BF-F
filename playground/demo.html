<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BF-F SDK Demo</title>

  <!-- Fake ad script bait -->
  <script async
    src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"
    onerror="window.adBlockerEnabled = true;">
  </script>

  <style>
    body {
      font-family: monospace;
      background: #0e0e0e;
      color: #ddd;
      padding: 20px;
    }

    .ok { color: #00ff9c; }
    .warn { color: #ffd166; }
    .bad { color: #ff5f5f; }

    .panel {
      margin-top: 20px;
      padding: 10px;
      border: 1px dashed #333;
    }

    .slider {
      width: 300px;
    }

    .signal {
      margin-left: 10px;
    }

    .bar {
      display: inline-block;
      height: 8px;
      background: #888;
      margin-left: 6px;
    }
  </style>
</head>
<body>

<h1>BF-F SDK Demo</h1>

<div class="panel">
  <label>
    Policy threshold:
    <input
      id="threshold"
      class="slider"
      type="range"
      min="0"
      max="1"
      step="0.01"
      value="0.6"
    />
    <span id="thresholdValue">0.60</span>
  </label>
</div>

<pre id="bot">Bot: checking...</pre>

<script src="../dist/browser.global.js"></script>
<script>
(async function () {
  const engine = BFF.create()
  const result = await engine.detect('bot')

  const thresholdInput = document.getElementById('threshold')
  const thresholdValue = document.getElementById('thresholdValue')
  const output = document.getElementById('bot')

  function evaluatePolicy(result, threshold) {
    if (result.confidence >= threshold) {
      return { action: 'block' }
    }
    if (result.confidence >= threshold * 0.6) {
      return { action: 'challenge' }
    }
    return { action: 'allow' }
  }

  function render(result, threshold) {
    const decision = evaluatePolicy(result, threshold)

    let cls = 'ok'
    if (decision.action === 'challenge') cls = 'warn'
    if (decision.action === 'block') cls = 'bad'

    let text = ''
    text += 'BOT DETECTION\n'
    text += `Suspicion score: ${result.suspicion.toFixed(2)}\n`
    text += `Normalized confidence: ${result.confidence.toFixed(2)}\n`
    text += `Policy threshold: ${threshold.toFixed(2)}\n`
    text += `Decision: ${decision.action.toUpperCase()}\n\n`
    text += 'Signals:\n'

    for (const s of result.signals) {
      const weight = s.weight ?? 1
      const conf = s.confidence ?? 0
      const contribution = weight * conf
      const barWidth = Math.min(100, contribution * 40)

      text += `- ${s.strategy}\n`
      text += `  confidence: ${conf}\n`
      text += `  weight: ${weight}\n`
      text += `  contribution: ${contribution.toFixed(2)} `
      text += `[${'#'.repeat(Math.round(barWidth / 10))}]\n\n`
    }

    output.textContent = text
    output.className = cls
  }

  thresholdInput.addEventListener('input', () => {
    const t = Number(thresholdInput.value)
    thresholdValue.textContent = t.toFixed(2)
    render(result, t)
  })

  render(result, Number(thresholdInput.value))
})()
</script>

</body>
</html>
